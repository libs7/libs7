## NB: we do not use s7_plugin_test here (this is not a plugin)

load("//config/cc:CONFIG.bzl",
     "BASE_COPTS", "BASE_LINKOPTS",
     "BASE_DEPS", "LOCAL_DEFINES")

SRCS          = []
DEPS          = BASE_DEPS + [
    "//src:s7",
    "//plugin:s7plugin_test_config",
    "@gopt//src:gopt",
    "@unity//src:unity",
    "@uthash//src:uthash",
]
INCLUDE_PATHS = [
    "-I$(GENDIR)/$(@)/plugin",
    "-I$(@gopt)/src",
    "-I$(@unity)/src",
    "-I$(@uthash)/src",
]
COPTS         = BASE_COPTS + INCLUDE_PATHS
DEFINES       = []
LINKOPTS      = BASE_LINKOPTS
TOOLCHAINS    = ["//:test_repo_paths"]
TIMEOUT       = "short"

###########
test_suite(
    name  = "unit",
    tests = [
        ":s7_test",
    ]
)

########################################
## s7 api tests extracted from ffitest.c
cc_test(
    name       = "s7_test",
    linkstatic = True,
    srcs       = SRCS + ["s7_test.c"],
    local_defines = LOCAL_DEFINES,
    defines    = DEFINES,
    deps       = DEPS,
    copts      = COPTS,
    linkopts   = LINKOPTS,
    toolchains = TOOLCHAINS,
    timeout    = TIMEOUT,
)
