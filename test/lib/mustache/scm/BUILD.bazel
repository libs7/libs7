load("@rules_cc//cc:defs.bzl", "cc_library")

load("//:BUILD.bzl",
     "BASE_SRCS", "BASE_DEPS", "BASE_INCLUDE_PATHS",
     "BASE_COPTS", "BASE_DEFINES", "BASE_LINKOPTS")

load("//test:BUILD.bzl",
     "TEST_SRCS", "TEST_DEPS", "TEST_INCLUDE_PATHS",
     "TEST_COPTS", "TEST_DEFINES", "TEST_LINKOPTS",
     "TIMEOUT")

SRCS          = BASE_SRCS + TEST_SRCS
INCLUDE_PATHS = BASE_INCLUDE_PATHS + TEST_INCLUDE_PATHS + [
    "-Ilib/libmustache/scm/s7"
]
COPTS         = BASE_COPTS + TEST_COPTS + INCLUDE_PATHS
DEPS          = BASE_DEPS + TEST_DEPS + [
    "//lib/libmustache/scm/s7:mustach_scm"
]
DEFINES       = BASE_DEFINES + TEST_DEFINES
LINKOPTS      = BASE_LINKOPTS + TEST_LINKOPTS
# load("//:BUILD.bzl", "COPTS", "LINKOPTS", "DEFINES", "DEPS")

# load("//test/lib/mustache:BUILD.bzl", "COPTS_TEST", "DEPS_TEST",
#      "DEFINES_TEST",
#      "TIMEOUT")

# load("//test/lib/mustache/scm:BUILD.bzl",
#      "SRCS",
#      "LIBS7", "LIBS7_HDRS",
#      "LIBS7_ADAPTER", "LIBS7_ADAPTER_HDRS",
#      "COPTS_S7", "DEPS_S7")

test_suite(
    name  = "test",
    tests = [
        "//test/lib/mustache/scm",
        "//test/lib/mustache/scm:comments",
    ]
)

################################################################
# cc_test(
#     name       = "alists",
#     linkstatic = True,
#     srcs       = ["alists_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

cc_test(
    name       = "comments",
    linkstatic = True,
    srcs       = SRCS + ["comments_test.c"],
    defines    = DEFINES,
    deps       = DEPS,
    copts      = COPTS,
    linkopts   = LINKOPTS,
    timeout    = TIMEOUT,
)

# cc_test(
#     name       = "delimiters",
#     linkstatic = True,
#     srcs       = SRCS + ["delimiters_test.c"],
#     defines    = DEFINES,
#     deps       = DEPS,
#     copts      = COPTS,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test( ## NOT SUPPORTED
#     name       = "dynamics",
#     linkstatic = True,
#     srcs       = SRCS+ ["dynamics_test.c"],
#     defines    = DEFINES,
#     deps       = DEPS,
#     copts      = COPTS,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

cc_test(
    name       = "interpolation",
    linkstatic = True,
    srcs       = SRCS + ["interpolation_test.c"],
    defines    = DEFINES,
    deps       = DEPS,
    copts      = COPTS,
    linkopts   = LINKOPTS,
    timeout    = TIMEOUT,
)

# cc_test(
#     name       = "inverted",
#     linkstatic = True,
#     srcs       = ["inverted_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "lists",
#     linkstatic = True,
#     srcs       = ["lists_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "maps",
#     linkstatic = True,
#     srcs       = ["maps_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "lambda",
#     linkstatic = True,
#     srcs       = ["lambda_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "predicates",
#     linkstatic = True,
#     srcs       = ["predicates_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# # test handling of "prefixes", constant text preceding tag and on same line
# cc_test(
#     name       = "prefixes",
#     linkstatic = True,
#     srcs       = ["prefix_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "partials",
#     linkstatic = True,
#     srcs       = ["partials_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "sections",
#     linkstatic = True,
#     srcs       = ["sections_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "sequences",
#     linkstatic = True,
#     srcs       = ["sequences_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

# cc_test(
#     name       = "vectors",
#     linkstatic = True,
#     srcs       = ["vectors_test.c"] + SRCS,
#     defines    = DEFINES + DEFINES_TEST,
#     deps       = DEPS + DEPS_TEST + DEPS_S7,
#     copts      = COPTS + COPTS_TEST + COPTS_S7,
#     linkopts   = LINKOPTS,
#     timeout    = TIMEOUT,
# )

